RDA3
A
3
262656
197888
5
UTF-8
1026
1
262153
4
data
16
72
262153
68
function\040(formula,\040data,\040subset,\040weights,\040na.action,\040method\040=\040\"qr\",\040
262153
71
\040\040\040\040model\040=\040TRUE,\040x\040=\040FALSE,\040y\040=\040FALSE,\040qr\040=\040TRUE,\040singular.ok\040=\040TRUE,\040
262153
35
\040\040\040\040contrasts\040=\040NULL,\040offset,\040...)\040
262153
1
{
262153
14
\040\040\040\040ret.x\040<-\040x
262153
14
\040\040\040\040ret.y\040<-\040y
262153
22
\040\040\040\040cl\040<-\040match.call()
262153
41
\040\040\040\040mf\040<-\040match.call(expand.dots\040=\040FALSE)
262153
70
\040\040\040\040m\040<-\040match(c(\"formula\",\040\"data\",\040\"subset\",\040\"weights\",\040\"na.action\",\040
262153
33
\040\040\040\040\040\040\040\040\"offset\"),\040names(mf),\0400L)
262153
22
\040\040\040\040mf\040<-\040mf[c(1L,\040m)]
262153
33
\040\040\040\040mf$drop.unused.levels\040<-\040TRUE
262153
41
\040\040\040\040mf[[1L]]\040<-\040quote(stats::model.frame)
262153
34
\040\040\040\040mf\040<-\040eval(mf,\040parent.frame())
262153
33
\040\040\040\040if\040(method\040==\040\"model.frame\")\040
262153
18
\040\040\040\040\040\040\040\040return(mf)
262153
29
\040\040\040\040else\040if\040(method\040!=\040\"qr\")\040
262153
71
\040\040\040\040\040\040\040\040warning(gettextf(\"method\040=\040\'%s\'\040is\040not\040supported.\040Using\040\'qr\'\",\040
262153
33
\040\040\040\040\040\040\040\040\040\040\040\040method),\040domain\040=\040NA)
262153
27
\040\040\040\040mt\040<-\040attr(mf,\040\"terms\")
262153
38
\040\040\040\040y\040<-\040model.response(mf,\040\"numeric\")
262153
37
\040\040\040\040w\040<-\040as.vector(model.weights(mf))
262153
39
\040\040\040\040if\040(!is.null(w)\040&&\040!is.numeric(w))\040
262153
50
\040\040\040\040\040\040\040\040stop(\"\'weights\'\040must\040be\040a\040numeric\040vector\")
262153
30
\040\040\040\040offset\040<-\040model.offset(mf)
262153
23
\040\040\040\040mlm\040<-\040is.matrix(y)
262153
19
\040\040\040\040ny\040<-\040if\040(mlm)\040
262153
15
\040\040\040\040\040\040\040\040nrow(y)
262153
18
\040\040\040\040else\040length(y)
262153
27
\040\040\040\040if\040(!is.null(offset))\040{
262153
18
\040\040\040\040\040\040\040\040if\040(!mlm)\040
262153
39
\040\040\040\040\040\040\040\040\040\040\040\040offset\040<-\040as.vector(offset)
262153
32
\040\040\040\040\040\040\040\040if\040(NROW(offset)\040!=\040ny)\040
262153
95
\040\040\040\040\040\040\040\040\040\040\040\040stop(gettextf(\"number\040of\040offsets\040is\040%d,\040should\040equal\040%d\040(number\040of\040observations)\",\040
262153
47
\040\040\040\040\040\040\040\040\040\040\040\040\040\040\040\040NROW(offset),\040ny),\040domain\040=\040NA)
262153
5
\040\040\040\040}
262153
29
\040\040\040\040if\040(is.empty.model(mt))\040{
262153
17
\040\040\040\040\040\040\040\040x\040<-\040NULL
262153
62
\040\040\040\040\040\040\040\040z\040<-\040list(coefficients\040=\040if\040(mlm)\040matrix(NA_real_,\0400,\040
262153
72
\040\040\040\040\040\040\040\040\040\040\040\040ncol(y))\040else\040numeric(),\040residuals\040=\040y,\040fitted.values\040=\0400\040*\040
262153
79
\040\040\040\040\040\040\040\040\040\040\040\040y,\040weights\040=\040w,\040rank\040=\0400L,\040df.residual\040=\040if\040(!is.null(w))\040sum(w\040!=\040
262153
23
\040\040\040\040\040\040\040\040\040\040\040\0400)\040else\040ny)
262153
31
\040\040\040\040\040\040\040\040if\040(!is.null(offset))\040{
262153
37
\040\040\040\040\040\040\040\040\040\040\040\040z$fitted.values\040<-\040offset
262153
37
\040\040\040\040\040\040\040\040\040\040\040\040z$residuals\040<-\040y\040-\040offset
262153
9
\040\040\040\040\040\040\040\040}
262153
5
\040\040\040\040}
262153
10
\040\040\040\040else\040{
262153
44
\040\040\040\040\040\040\040\040x\040<-\040model.matrix(mt,\040mf,\040contrasts)
262153
29
\040\040\040\040\040\040\040\040z\040<-\040if\040(is.null(w))\040
262153
69
\040\040\040\040\040\040\040\040\040\040\040\040lm.fit(x,\040y,\040offset\040=\040offset,\040singular.ok\040=\040singular.ok,\040
262153
20
\040\040\040\040\040\040\040\040\040\040\040\040\040\040\040\040...)
262153
74
\040\040\040\040\040\040\040\040else\040lm.wfit(x,\040y,\040w,\040offset\040=\040offset,\040singular.ok\040=\040singular.ok,\040
262153
16
\040\040\040\040\040\040\040\040\040\040\040\040...)
262153
5
\040\040\040\040}
262153
39
\040\040\040\040class(z)\040<-\040c(if\040(mlm)\040\"mlm\",\040\"lm\")
262153
40
\040\040\040\040z$na.action\040<-\040attr(mf,\040\"na.action\")
262153
22
\040\040\040\040z$offset\040<-\040offset
262153
39
\040\040\040\040z$contrasts\040<-\040attr(x,\040\"contrasts\")
262153
36
\040\040\040\040z$xlevels\040<-\040.getXlevels(mt,\040mf)
262153
16
\040\040\040\040z$call\040<-\040cl
262153
17
\040\040\040\040z$terms\040<-\040mt
262153
15
\040\040\040\040if\040(model)\040
262153
21
\040\040\040\040\040\040\040\040z$model\040<-\040mf
262153
15
\040\040\040\040if\040(ret.x)\040
262153
16
\040\040\040\040\040\040\040\040z$x\040<-\040x
262153
15
\040\040\040\040if\040(ret.y)\040
262153
16
\040\040\040\040\040\040\040\040z$y\040<-\040y
262153
13
\040\040\040\040if\040(!qr)\040
262153
20
\040\040\040\040\040\040\040\040z$qr\040<-\040NULL
262153
5
\040\040\040\040z
262153
1
}
254
