 [1] "function (formula, data, subset, weights, na.action, method = \"qr\", "                           
 [2] "    model = TRUE, x = FALSE, y = FALSE, qr = TRUE, singular.ok = TRUE, "                          
 [3] "    contrasts = NULL, offset, ...) "                                                              
 [4] "{"                                                                                                
 [5] "    ret.x <- x"                                                                                   
 [6] "    ret.y <- y"                                                                                   
 [7] "    cl <- match.call()"                                                                           
 [8] "    mf <- match.call(expand.dots = FALSE)"                                                        
 [9] "    m <- match(c(\"formula\", \"data\", \"subset\", \"weights\", \"na.action\", "                 
[10] "        \"offset\"), names(mf), 0L)"                                                              
[11] "    mf <- mf[c(1L, m)]"                                                                           
[12] "    mf$drop.unused.levels <- TRUE"                                                                
[13] "    mf[[1L]] <- quote(stats::model.frame)"                                                        
[14] "    mf <- eval(mf, parent.frame())"                                                               
[15] "    if (method == \"model.frame\") "                                                              
[16] "        return(mf)"                                                                               
[17] "    else if (method != \"qr\") "                                                                  
[18] "        warning(gettextf(\"method = '%s' is not supported. Using 'qr'\", "                        
[19] "            method), domain = NA)"                                                                
[20] "    mt <- attr(mf, \"terms\")"                                                                    
[21] "    y <- model.response(mf, \"numeric\")"                                                         
[22] "    w <- as.vector(model.weights(mf))"                                                            
[23] "    if (!is.null(w) && !is.numeric(w)) "                                                          
[24] "        stop(\"'weights' must be a numeric vector\")"                                             
[25] "    offset <- model.offset(mf)"                                                                   
[26] "    mlm <- is.matrix(y)"                                                                          
[27] "    ny <- if (mlm) "                                                                              
[28] "        nrow(y)"                                                                                  
[29] "    else length(y)"                                                                               
[30] "    if (!is.null(offset)) {"                                                                      
[31] "        if (!mlm) "                                                                               
[32] "            offset <- as.vector(offset)"                                                          
[33] "        if (NROW(offset) != ny) "                                                                 
[34] "            stop(gettextf(\"number of offsets is %d, should equal %d (number of observations)\", "
[35] "                NROW(offset), ny), domain = NA)"                                                  
[36] "    }"                                                                                            
[37] "    if (is.empty.model(mt)) {"                                                                    
[38] "        x <- NULL"                                                                                
[39] "        z <- list(coefficients = if (mlm) matrix(NA_real_, 0, "                                   
[40] "            ncol(y)) else numeric(), residuals = y, fitted.values = 0 * "                         
[41] "            y, weights = w, rank = 0L, df.residual = if (!is.null(w)) sum(w != "                  
[42] "            0) else ny)"                                                                          
[43] "        if (!is.null(offset)) {"                                                                  
[44] "            z$fitted.values <- offset"                                                            
[45] "            z$residuals <- y - offset"                                                            
[46] "        }"                                                                                        
[47] "    }"                                                                                            
[48] "    else {"                                                                                       
[49] "        x <- model.matrix(mt, mf, contrasts)"                                                     
[50] "        z <- if (is.null(w)) "                                                                    
[51] "            lm.fit(x, y, offset = offset, singular.ok = singular.ok, "                            
[52] "                ...)"                                                                             
[53] "        else lm.wfit(x, y, w, offset = offset, singular.ok = singular.ok, "                       
[54] "            ...)"                                                                                 
[55] "    }"                                                                                            
[56] "    class(z) <- c(if (mlm) \"mlm\", \"lm\")"                                                      
[57] "    z$na.action <- attr(mf, \"na.action\")"                                                       
[58] "    z$offset <- offset"                                                                           
[59] "    z$contrasts <- attr(x, \"contrasts\")"                                                        
[60] "    z$xlevels <- .getXlevels(mt, mf)"                                                             
[61] "    z$call <- cl"                                                                                 
[62] "    z$terms <- mt"                                                                                
[63] "    if (model) "                                                                                  
[64] "        z$model <- mf"                                                                            
[65] "    if (ret.x) "                                                                                  
[66] "        z$x <- x"                                                                                 
[67] "    if (ret.y) "                                                                                  
[68] "        z$y <- y"                                                                                 
[69] "    if (!qr) "                                                                                    
[70] "        z$qr <- NULL"                                                                             
[71] "    z"                                                                                            
[72] "}"                                                                                                
