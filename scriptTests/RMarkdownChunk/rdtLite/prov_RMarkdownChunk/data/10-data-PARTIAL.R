  [1] "new(\"functionWithTrace\", .Data = function (..., list = character(), "                                   
  [2] "    package = NULL, lib.loc = NULL, verbose = getOption(\"verbose\"), "                                   
  [3] "    envir = .GlobalEnv, overwrite = TRUE) "                                                               
  [4] "{"                                                                                                        
  [5] "    .doTrace(rdtLite:::.ddg.trace.output())"                                                              
  [6] "    {"                                                                                                    
  [7] "        fileExt <- function(x) {"                                                                         
  [8] "            db <- grepl(\"\\\\.[^.]+\\\\.(gz|bz2|xz)$\", x)"                                              
  [9] "            ans <- sub(\".*\\\\.\", \"\", x)"                                                             
 [10] "            ans[db] <- sub(\".*\\\\.([^.]+\\\\.)(gz|bz2|xz)$\", \"\\\\1\\\\2\", "                         
 [11] "                x[db])"                                                                                   
 [12] "            ans"                                                                                          
 [13] "        }"                                                                                                
 [14] "        my_read_table <- function(...) {"                                                                 
 [15] "            lcc <- Sys.getlocale(\"LC_COLLATE\")"                                                         
 [16] "            on.exit(Sys.setlocale(\"LC_COLLATE\", lcc))"                                                  
 [17] "            Sys.setlocale(\"LC_COLLATE\", \"C\")"                                                         
 [18] "            read.table(...)"                                                                              
 [19] "        }"                                                                                                
 [20] "        stopifnot(is.character(list))"                                                                    
 [21] "        names <- c(as.character(substitute(list(...))[-1L]), "                                            
 [22] "            list)"                                                                                        
 [23] "        if (!is.null(package)) {"                                                                         
 [24] "            if (!is.character(package)) "                                                                 
 [25] "                stop(\"'package' must be a character vector or NULL\")"                                   
 [26] "        }"                                                                                                
 [27] "        paths <- find.package(package, lib.loc, verbose = verbose)"                                       
 [28] "        if (is.null(lib.loc)) "                                                                           
 [29] "            paths <- c(path.package(package, TRUE), if (!length(package)) getwd(), "                      
 [30] "                paths)"                                                                                   
 [31] "        paths <- unique(normalizePath(paths[file.exists(paths)]))"                                        
 [32] "        paths <- paths[dir.exists(file.path(paths, \"data\"))]"                                           
 [33] "        dataExts <- tools:::.make_file_exts(\"data\")"                                                    
 [34] "        if (length(names) == 0L) {"                                                                       
 [35] "            db <- matrix(character(), nrow = 0L, ncol = 4L)"                                              
 [36] "            for (path in paths) {"                                                                        
 [37] "                entries <- NULL"                                                                          
 [38] "                packageName <- if (file_test(\"-f\", file.path(path, "                                    
 [39] "                  \"DESCRIPTION\"))) "                                                                    
 [40] "                  basename(path)"                                                                         
 [41] "                else \".\""                                                                               
 [42] "                if (file_test(\"-f\", INDEX <- file.path(path, "                                          
 [43] "                  \"Meta\", \"data.rds\"))) {"                                                            
 [44] "                  entries <- readRDS(INDEX)"                                                              
 [45] "                }"                                                                                        
 [46] "                else {"                                                                                   
 [47] "                  dataDir <- file.path(path, \"data\")"                                                   
 [48] "                  entries <- tools::list_files_with_type(dataDir, "                                       
 [49] "                    \"data\")"                                                                            
 [50] "                  if (length(entries)) {"                                                                 
 [51] "                    entries <- unique(tools::file_path_sans_ext(basename(entries)))"                      
 [52] "                    entries <- cbind(entries, \"\")"                                                      
 [53] "                  }"                                                                                      
 [54] "                }"                                                                                        
 [55] "                if (NROW(entries)) {"                                                                     
 [56] "                  if (is.matrix(entries) && ncol(entries) == "                                            
 [57] "                    2L) "                                                                                 
 [58] "                    db <- rbind(db, cbind(packageName, dirname(path), "                                   
 [59] "                      entries))"                                                                          
 [60] "                  else warning(gettextf(\"data index for package %s is invalid and will be ignored\", "   
 [61] "                    sQuote(packageName)), domain = NA, call. = FALSE)"                                    
 [62] "                }"                                                                                        
 [63] "            }"                                                                                            
 [64] "            colnames(db) <- c(\"Package\", \"LibPath\", \"Item\", \"Title\")"                             
 [65] "            footer <- if (missing(package)) "                                                             
 [66] "                paste0(\"Use \", sQuote(paste(\"data(package =\", "                                       
 [67] "                  \".packages(all.available = TRUE))\")), \"\\n\", "                                      
 [68] "                  \"to list the data sets in all *available* packages.\")"                                
 [69] "            else NULL"                                                                                    
 [70] "            y <- list(title = \"Data sets\", header = NULL, results = db, "                               
 [71] "                footer = footer)"                                                                         
 [72] "            class(y) <- \"packageIQR\""                                                                   
 [73] "            return(y)"                                                                                    
 [74] "        }"                                                                                                
 [75] "        paths <- file.path(paths, \"data\")"                                                              
 [76] "        for (name in names) {"                                                                            
 [77] "            found <- FALSE"                                                                               
 [78] "            for (p in paths) {"                                                                           
 [79] "                tmp_env <- if (overwrite) "                                                               
 [80] "                  envir"                                                                                  
 [81] "                else new.env()"                                                                           
 [82] "                if (file_test(\"-f\", file.path(p, \"Rdata.rds\"))) {"                                    
 [83] "                  rds <- readRDS(file.path(p, \"Rdata.rds\"))"                                            
 [84] "                  if (name %in% names(rds)) {"                                                            
 [85] "                    found <- TRUE"                                                                        
 [86] "                    if (verbose) "                                                                        
 [87] "                      message(sprintf(\"name=%s:\\t found in Rdata.rds\", "                               
 [88] "                        name), domain = NA)"                                                              
 [89] "                    thispkg <- sub(\".*/([^/]*)/data$\", \"\\\\1\", "                                     
 [90] "                      p)"                                                                                 
 [91] "                    thispkg <- sub(\"_.*$\", \"\", thispkg)"                                              
 [92] "                    thispkg <- paste0(\"package:\", thispkg)"                                             
 [93] "                    objs <- rds[[name]]"                                                                  
 [94] "                    lazyLoad(file.path(p, \"Rdata\"), envir = tmp_env, "                                  
 [95] "                      filter = function(x) x %in% objs)"                                                  
 [96] "                    break"                                                                                
 [97] "                  }"                                                                                      
 [98] "                  else if (verbose) "                                                                     
 [99] "                    message(sprintf(\"name=%s:\\t NOT found in names() of Rdata.rds, i.e.,\\n\\t%s\\n\", "
[100] "                      name, paste(names(rds), collapse = \",\")), "                                       
[101] "                      domain = NA)"                                                                       
[102] "                }"                                                                                        
[103] "                if (file_test(\"-f\", file.path(p, \"Rdata.zip\"))) {"                                    
[104] "                  warning(\"zipped data found for package \", sQuote(basename(dirname(p))), "             
[105] "                    \".\\nThat is defunct, so please re-install the package.\", "                         
[106] "                    domain = NA)"                                                                         
[107] "                  if (file_test(\"-f\", fp <- file.path(p, \"filelist\"))) "                              
[108] "                    files <- file.path(p, scan(fp, what = \"\", "                                         
[109] "                      quiet = TRUE))"                                                                     
[110] "                  else {"                                                                                 
[111] "                    warning(gettextf(\"file 'filelist' is missing for directory %s\", "                   
[112] "                      sQuote(p)), domain = NA)"                                                           
[113] "                    next"                                                                                 
[114] "                  }"                                                                                      
[115] "                }"                                                                                        
[116] "                else {"                                                                                   
[117] "                  files <- list.files(p, full.names = TRUE)"                                              
[118] "                }"                                                                                        
[119] "                files <- files[grep(name, files, fixed = TRUE)]"                                          
[120] "                if (length(files) > 1L) {"                                                                
[121] "                  o <- match(fileExt(files), dataExts, nomatch = 100L)"                                   
[122] "                  paths0 <- dirname(files)"                                                               
[123] "                  paths0 <- factor(paths0, levels = unique(paths0))"                                      
[124] "                  files <- files[order(paths0, o)]"                                                       
[125] "                }"                                                                                        
[126] "                if (length(files)) {"                                                                     
[127] "                  for (file in files) {"                                                                  
[128] "                    if (verbose) "                                                                        
[129] "                      message(\"name=\", name, \":\\t file= ...\", "                                      
[130] "                        .Platform$file.sep, basename(file), \"::\\t\", "                                  
[131] "                        appendLF = FALSE, domain = NA)"                                                   
[132] "                    ext <- fileExt(file)"                                                                 
[133] "                    if (basename(file) != paste0(name, \".\", ext)) "                                     
[134] "                      found <- FALSE"                                                                     
[135] "                    else {"                                                                               
[136] "                      found <- TRUE"                                                                      
[137] "                      zfile <- file"                                                                      
[138] "                      zipname <- file.path(dirname(file), \"Rdata.zip\")"                                 
[139] "                      if (file.exists(zipname)) {"                                                        
[140] "                        Rdatadir <- tempfile(\"Rdata\")"                                                  
[141] "                        dir.create(Rdatadir, showWarnings = FALSE)"                                       
[142] "                        topic <- basename(file)"                                                          
[143] "                        rc <- .External(C_unzip, zipname, topic, "                                        
[144] "                          Rdatadir, FALSE, TRUE, FALSE, FALSE)"                                           
[145] "                        if (rc == 0L) "                                                                   
[146] "                          zfile <- file.path(Rdatadir, topic)"                                            
[147] "                      }"                                                                                  
[148] "                      if (zfile != file) "                                                                
[149] "                        on.exit(unlink(zfile))"                                                           
[150] "                      switch(ext, R = , r = {"                                                            
[151] "                        library(\"utils\")"                                                               
[152] "                        sys.source(zfile, chdir = TRUE, envir = tmp_env)"                                 
[153] "                      }, RData = , rdata = , rda = load(zfile, "                                          
[154] "                        envir = tmp_env), TXT = , txt = , tab = , "                                       
[155] "                        tab.gz = , tab.bz2 = , tab.xz = , txt.gz = , "                                    
[156] "                        txt.bz2 = , txt.xz = assign(name, my_read_table(zfile, "                          
[157] "                          header = TRUE, as.is = FALSE), envir = tmp_env), "                              
[158] "                        CSV = , csv = , csv.gz = , csv.bz2 = , "                                          
[159] "                        csv.xz = assign(name, my_read_table(zfile, "                                      
[160] "                          header = TRUE, sep = \";\", as.is = FALSE), "                                   
[161] "                          envir = tmp_env), found <- FALSE)"                                              
[162] "                    }"                                                                                    
[163] "                    if (found) "                                                                          
[164] "                      break"                                                                              
[165] "                  }"                                                                                      
[166] "                  if (verbose) "                                                                          
[167] "                    message(if (!found) "                                                                 
[168] "                      \"*NOT* \", \"found\", domain = NA)"                                                
[169] "                }"                                                                                        
[170] "                if (found) "                                                                              
[171] "                  break"                                                                                  
[172] "            }"                                                                                            
[173] "            if (!found) {"                                                                                
[174] "                warning(gettextf(\"data set %s not found\", sQuote(name)), "                              
[175] "                  domain = NA)"                                                                           
[176] "            }"                                                                                            
[177] "            else if (!overwrite) {"                                                                       
[178] "                for (o in ls(envir = tmp_env, all.names = TRUE)) {"                                       
[179] "                  if (exists(o, envir = envir, inherits = FALSE)) "                                       
[180] "                    warning(gettextf(\"an object named %s already exists and will not be overwritten\", " 
[181] "                      sQuote(o)))"                                                                        
[182] "                  else assign(o, get(o, envir = tmp_env, inherits = FALSE), "                             
[183] "                    envir = envir)"                                                                       
[184] "                }"                                                                                        
[185] "                rm(tmp_env)"                                                                              
[186] "            }"                                                                                            
[187] "        }"                                                                                                
[188] "        invisible(names)"                                                                                 
[189] "    }"                                                                                                    
[190] "}, original = function (..., list = character(), package = NULL, "                                        
[191] "    lib.loc = NULL, verbose = getOption(\"verbose\"), envir = .GlobalEnv, "                               
[192] "    overwrite = TRUE) "                                                                                   
[193] "{"                                                                                                        
[194] "    fileExt <- function(x) {"                                                                             
[195] "        db <- grepl(\"\\\\.[^.]+\\\\.(gz|bz2|xz)$\", x)"                                                  
[196] "        ans <- sub(\".*\\\\.\", \"\", x)"                                                                 
[197] "        ans[db] <- sub(\".*\\\\.([^.]+\\\\.)(gz|bz2|xz)$\", \"\\\\1\\\\2\", "                             
[198] "            x[db])"                                                                                       
[199] "        ans"                                                                                              
[200] "    }"                                                                                                    
[201] "    my_read_table <- function(...) {"                                                                     
[202] "        lcc <- Sys.getlocale(\"LC_COLLATE\")"                                                             
[203] "        on.exit(Sys.setlocale(\"LC_COLLATE\", lcc))"                                                      
[204] "        Sys.setlocale(\"LC_COLLATE\", \"C\")"                                                             
[205] "        read.table(...)"                                                                                  
[206] "    }"                                                                                                    
[207] "    stopifnot(is.character(list))"                                                                        
[208] "    names <- c(as.character(substitute(list(...))[-1L]), list)"                                           
[209] "    if (!is.null(package)) {"                                                                             
[210] "        if (!is.character(package)) "                                                                     
[211] "            stop(\"'package' must be a character vector or NULL\")"                                       
[212] "    }"                                                                                                    
[213] "    paths <- find.package(package, lib.loc, verbose = verbose)"                                           
[214] "    if (is.null(lib.loc)) "                                                                               
[215] "        paths <- c(path.package(package, TRUE), if (!length(package)) getwd(), "                          
[216] "            paths)"                                                                                       
[217] "    paths <- unique(normalizePath(paths[file.exists(paths)]))"                                            
[218] "    paths <- paths[dir.exists(file.path(paths, \"data\"))]"                                               
[219] "    dataExts <- tools:::.make_file_exts(\"data\")"                                                        
[220] "    if (length(names) == 0L) {"                                                                           
[221] "        db <- matrix(character(), nrow = 0L, ncol = 4L)"                                                  
[222] "        for (path in paths) {"                                                                            
[223] "            entries <- NULL"                                                                              
[224] "            packageName <- if (file_test(\"-f\", file.path(path, "                                        
[225] "                \"DESCRIPTION\"))) "                                                                      
[226] "                basename(path)"                                                                           
[227] "            else \".\""                                                                                   
[228] "            if (file_test(\"-f\", INDEX <- file.path(path, \"Meta\", "                                    
[229] "                \"data.rds\"))) {"                                                                        
[230] "                entries <- readRDS(INDEX)"                                                                
[231] "            }"                                                                                            
[232] "            else {"                                                                                       
[233] "                dataDir <- file.path(path, \"data\")"                                                     
[234] "                entries <- tools::list_files_with_type(dataDir, "                                         
[235] "                  \"data\")"                                                                              
[236] "                if (length(entries)) {"                                                                   
[237] "                  entries <- unique(tools::file_path_sans_ext(basename(entries)))"                        
[238] "                  entries <- cbind(entries, \"\")"                                                        
[239] "                }"                                                                                        
[240] "            }"                                                                                            
[241] "            if (NROW(entries)) {"                                                                         
[242] "                if (is.matrix(entries) && ncol(entries) == 2L) "                                          
[243] "                  db <- rbind(db, cbind(packageName, dirname(path), "                                     
[244] "                    entries))"                                                                            
[245] "                else warning(gettextf(\"data index for package %s is invalid and will be ignored\", "     
[246] "                  sQuote(packageName)), domain = NA, call. = FALSE)"                                      
[247] "            }"                                                                                            
[248] "        }"                                                                                                
[249] "        colnames(db) <- c(\"Package\", \"LibPath\", \"Item\", \"Title\")"                                 
[250] "        footer <- if (missing(package)) "                                                                 
[251] "            paste0(\"Use \", sQuote(paste(\"data(package =\", \".packages(all.available = TRUE))\")), "   
[252] "                \"\\n\", \"to list the data sets in all *available* packages.\")"                         
[253] "        else NULL"                                                                                        
[254] "        y <- list(title = \"Data sets\", header = NULL, results = db, "                                   
[255] "            footer = footer)"                                                                             
[256] "        class(y) <- \"packageIQR\""                                                                       
[257] "        return(y)"                                                                                        
[258] "    }"                                                                                                    
[259] "    paths <- file.path(paths, \"data\")"                                                                  
[260] "    for (name in names) {"                                                                                
[261] "        found <- FALSE"                                                                                   
[262] "        for (p in paths) {"                                                                               
[263] "            tmp_env <- if (overwrite) "                                                                   
[264] "                envir"                                                                                    
[265] "            else new.env()"                                                                               
[266] "            if (file_test(\"-f\", file.path(p, \"Rdata.rds\"))) {"                                        
[267] "                rds <- readRDS(file.path(p, \"Rdata.rds\"))"                                              
[268] "                if (name %in% names(rds)) {"                                                              
[269] "                  found <- TRUE"                                                                          
[270] "                  if (verbose) "                                                                          
[271] "                    message(sprintf(\"name=%s:\\t found in Rdata.rds\", "                                 
[272] "                      name), domain = NA)"                                                                
[273] "                  thispkg <- sub(\".*/([^/]*)/data$\", \"\\\\1\", p)"                                     
[274] "                  thispkg <- sub(\"_.*$\", \"\", thispkg)"                                                
[275] "                  thispkg <- paste0(\"package:\", thispkg)"                                               
[276] "                  objs <- rds[[name]]"                                                                    
[277] "                  lazyLoad(file.path(p, \"Rdata\"), envir = tmp_env, "                                    
[278] "                    filter = function(x) x %in% objs)"                                                    
[279] "                  break"                                                                                  
[280] "                }"                                                                                        
[281] "                else if (verbose) "                                                                       
[282] "                  message(sprintf(\"name=%s:\\t NOT found in names() of Rdata.rds, i.e.,\\n\\t%s\\n\", "  
[283] "                    name, paste(names(rds), collapse = \",\")), "                                         
[284] "                    domain = NA)"                                                                         
[285] "            }"                                                                                            
[286] "            if (file_test(\"-f\", file.path(p, \"Rdata.zip\"))) {"                                        
[287] "                warning(\"zipped data found for package \", sQuote(basename(dirname(p))), "               
[288] "                  \".\\nThat is defunct, so please re-install the package.\", "                           
[289] "                  domain = NA)"                                                                           
[290] "                if (file_test(\"-f\", fp <- file.path(p, \"filelist\"))) "                                
[291] "                  files <- file.path(p, scan(fp, what = \"\", quiet = TRUE))"                             
[292] "                else {"                                                                                   
[293] "                  warning(gettextf(\"file 'filelist' is missing for directory %s\", "                     
[294] "                    sQuote(p)), domain = NA)"                                                             
[295] "                  next"                                                                                   
[296] "                }"                                                                                        
[297] "            }"                                                                                            
[298] "            else {"                                                                                       
[299] "                files <- list.files(p, full.names = TRUE)"                                                
[300] "            }"                                                                                            
[301] "            files <- files[grep(name, files, fixed = TRUE)]"                                              
[302] "            if (length(files) > 1L) {"                                                                    
[303] "                o <- match(fileExt(files), dataExts, nomatch = 100L)"                                     
[304] "                paths0 <- dirname(files)"                                                                 
[305] "                paths0 <- factor(paths0, levels = unique(paths0))"                                        
[306] "                files <- files[order(paths0, o)]"                                                         
[307] "            }"                                                                                            
[308] "            if (length(files)) {"                                                                         
[309] "                for (file in files) {"                                                                    
[310] "                  if (verbose) "                                                                          
[311] "                    message(\"name=\", name, \":\\t file= ...\", .Platform$file.sep, "                    
[312] "                      basename(file), \"::\\t\", appendLF = FALSE, "                                      
[313] "                      domain = NA)"                                                                       
[314] "                  ext <- fileExt(file)"                                                                   
[315] "                  if (basename(file) != paste0(name, \".\", ext)) "                                       
[316] "                    found <- FALSE"                                                                       
[317] "                  else {"                                                                                 
[318] "                    found <- TRUE"                                                                        
[319] "                    zfile <- file"                                                                        
[320] "                    zipname <- file.path(dirname(file), \"Rdata.zip\")"                                   
[321] "                    if (file.exists(zipname)) {"                                                          
[322] "                      Rdatadir <- tempfile(\"Rdata\")"                                                    
[323] "                      dir.create(Rdatadir, showWarnings = FALSE)"                                         
[324] "                      topic <- basename(file)"                                                            
[325] "                      rc <- .External(C_unzip, zipname, topic, "                                          
[326] "                        Rdatadir, FALSE, TRUE, FALSE, FALSE)"                                             
[327] "                      if (rc == 0L) "                                                                     
[328] "                        zfile <- file.path(Rdatadir, topic)"                                              
[329] "                    }"                                                                                    
[330] "                    if (zfile != file) "                                                                  
[331] "                      on.exit(unlink(zfile))"                                                             
[332] "                    switch(ext, R = , r = {"                                                              
[333] "                      library(\"utils\")"                                                                 
[334] "                      sys.source(zfile, chdir = TRUE, envir = tmp_env)"                                   
[335] "                    }, RData = , rdata = , rda = load(zfile, "                                            
[336] "                      envir = tmp_env), TXT = , txt = , tab = , "                                         
[337] "                      tab.gz = , tab.bz2 = , tab.xz = , txt.gz = , "                                      
[338] "                      txt.bz2 = , txt.xz = assign(name, my_read_table(zfile, "                            
[339] "                        header = TRUE, as.is = FALSE), envir = tmp_env), "                                
[340] "                      CSV = , csv = , csv.gz = , csv.bz2 = , "                                            
[341] "                      csv.xz = assign(name, my_read_table(zfile, "                                        
[342] "                        header = TRUE, sep = \";\", as.is = FALSE), "                                     
[343] "                        envir = tmp_env), found <- FALSE)"                                                
[344] "                  }"                                                                                      
[345] "                  if (found) "                                                                            
[346] "                    break"                                                                                
[347] "                }"                                                                                        
[348] "                if (verbose) "                                                                            
[349] "                  message(if (!found) "                                                                   
[350] "                    \"*NOT* \", \"found\", domain = NA)"                                                  
[351] "            }"                                                                                            
[352] "            if (found) "                                                                                  
[353] "                break"                                                                                    
[354] "        }"                                                                                                
[355] "        if (!found) {"                                                                                    
[356] "            warning(gettextf(\"data set %s not found\", sQuote(name)), "                                  
[357] "                domain = NA)"                                                                             
[358] "        }"                                                                                                
[359] "        else if (!overwrite) {"                                                                           
[360] "            for (o in ls(envir = tmp_env, all.names = TRUE)) {"                                           
[361] "                if (exists(o, envir = envir, inherits = FALSE)) "                                         
[362] "                  warning(gettextf(\"an object named %s already exists and will not be overwritten\", "   
[363] "                    sQuote(o)))"                                                                          
[364] "                else assign(o, get(o, envir = tmp_env, inherits = FALSE), "                               
[365] "                  envir = envir)"                                                                         
[366] "            }"                                                                                            
[367] "            rm(tmp_env)"                                                                                  
[368] "        }"                                                                                                
[369] "    }"                                                                                                    
[370] "    invisible(names)"                                                                                     
[371] "}, source = <environment>)"                                                                               
